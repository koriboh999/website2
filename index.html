<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart of Fear WeakAura</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/babel-standalone@7.22.9/Babel.min.js"></script>
    <style>
        body {
            background-color: #1a202c;
            color: #e2e8f0;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <header class="bg-gray-900 py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center">Heart of Fear WeakAura</h1>
            <p class="text-center mt-2 text-gray-400">Latest WeakAura string for Heart of Fear raid</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 flex-grow">
        <div class="mb-8">
            <label class="block text-lg font-semibold mb-2">Manually Upload WeakAura File (if fetch fails)</label>
            <input
                type="file"
                accept=".txt"
                id="fileInput"
                class="block w-full text-sm text-gray-200 file:mr-4 file:py-2 file:px-4 file:rounded file:bg-blue-600 file:text-white file:font-semibold file:hover:bg-blue-700"
            />
        </div>
        <div id="root"></div>
    </main>

    <footer class="bg-gray-900 py-4 text-center text-gray-400">
        <p>&copy; 2025 Heart of Fear WeakAura Viewer. All rights reserved.</p>
    </footer>

    <script type="text/babel">
        function AuraCard({ fileName, auraString }) {
            const copyToClipboard = () => {
                navigator.clipboard.writeText(auraString)
                    .then(() => alert(`Copied ${fileName} to clipboard!`))
                    .catch(err => {
                        console.error('Failed to copy:', err);
                        alert('Failed to copy to clipboard. Please try again.');
                    });
            };

            return (
                <div className="bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow max-w-2xl mx-auto">
                    <h2 className="text-xl font-semibold mb-4">{fileName}</h2>
                    <div className="relative">
                        <textarea
                            className="w-full h-32 p-2 bg-gray-700 text-gray-200 rounded resize-none"
                            value={auraString}
                            readOnly
                        ></textarea>
                        <button
                            onClick={copyToClipboard}
                            className="absolute top-2 right-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-3 rounded transition-colors"
                        >
                            Copy
                        </button>
                    </div>
                </div>
            );
        }

        function App() {
            const [aura, setAura] = React.useState(null);
            const [error, setError] = React.useState(null);

            // Hardcoded folder and filename
            const folderPath = 'weakauras/HoF';
            const fileName = 'latest.txt'; // Ensure this matches the file in weakauras/HoF

            const fetchAura = async () => {
                try {
                    const response = await fetch(`${folderPath}/${fileName}`);
                    if (!response.ok) throw new Error(`Failed to fetch ${fileName}: ${response.statusText}`);
                    const text = await response.text();
                    setAura({ fileName, auraString: text });
                    setError(null);
                } catch (err) {
                    console.error('Error fetching aura:', err);
                    setError(`Failed to load ${fileName}. Ensure the file exists in weakauras/HoF and the server is running.`);
                    setAura(null);
                }
            };

            React.useEffect(() => {
                fetchAura();

                // Poll every 30 seconds for updates
                const interval = setInterval(fetchAura, 30000);
                return () => clearInterval(interval);
            }, []);

            // Handle manual file upload
            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file && file.name.endsWith('.txt')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setAura({ fileName: file.name, auraString: e.target.result });
                        setError(null);
                    };
                    reader.onerror = (err) => {
                        console.error('Error reading file:', err);
                        setError('Failed to read the uploaded file.');
                    };
                    reader.readAsText(file);
                } else {
                    setError('Please upload a valid .txt file.');
                }
            };

            React.useEffect(() => {
                const fileInput = document.getElementById('fileInput');
                fileInput.addEventListener('change', handleFileUpload);
                return () => fileInput.removeEventListener('change', handleFileUpload);
            }, []);

            return (
                <div>
                    {error && (
                        <div className="text-red-500 text-center mb-4">{error}</div>
                    )}
                    {aura ? (
                        <AuraCard fileName={aura.fileName} auraString={aura.auraString} />
                    ) : (
                        !error && <p className="text-center">Loading WeakAura...</p>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
